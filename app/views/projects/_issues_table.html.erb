<div data-controller="issues-search" class="mt-6 overflow-x-auto" id="issues-container">
  <div class="mb-4">
    <label for="issues-search" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
    <div class="relative max-w-md ml-auto">
      <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
        <i class="fas fa-search w-4 h-4 text-gray-500"></i>
      </div>
      <input type="search" name="query" id="issues-search"
            class="search block w-full p-4 ps-10 text-sm font-medium text-gray-900 border border-gray-300 rounded-sm bg-white focus:ring-blue-500 focus:border-blue-500"
            placeholder="Search issues..." />
    </div> 
  </div>

  <div id="issues">
    <% if @project.issues.any? %>
      <table class="min-w-full border border-gray-200 divide-y divide-gray-200 rounded-lg shadow-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Issue No</th>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Title</th>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Date Created</th>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Assigned To</th>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Status</th>
            <th class="px-4 py-2 text-center text-sm font-semibold text-gray-600">Action</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200 tableBody" data-issues-search-target="tableBody">
          <% @project.issues.each do |issue| %>
            <tr data-id="<%= issue.id %>" class="text-sm">
              <td class="px-2 py-1 text-center text-gray-800 issue_number"><%= issue.issue_number %></td>
              <td class="px-2 py-1 text-center text-gray-800 title"><%= issue.title %></td>
              <td class="px-2 py-1 text-center text-gray-600"><%= issue.created_at.strftime("%b %d, %Y") %></td>
              <td class="px-2 py-1 text-center text-gray-600 assigned_to"><%= issue.assigned_to.present? ? User.find(issue.assigned_to).name : "Unassigned" %></td>
              <td class="px-2 py-1 text-center">
                <span class="px-2 py-1 text-xs font-medium rounded-full status
                  <%= case issue.status
                      when "open" then "bg-green-100 text-green-700"
                      when "on_hold" then "bg-yellow-100 text-yellow-700"
                      when "in_progress" then "bg-blue-100 text-blue-700"
                      when "closed" then "bg-gray-200 text-gray-700"
                      else "bg-gray-100 text-gray-600"
                      end %>">
                  <%= issue.status.humanize %>
                </span>
              </td>
              <td class="px-2 py-1 text-center text-gray-800">
                <button id="issues_dropdown_<%= issue.id %>" data-dropdown-toggle="issues_dropdown_id<%= issue.id %>" class="text-3xl cursor-pointer" type="button">
                  <i class="fa-solid fa-ellipsis"></i>
                </button>
                <div id="issues_dropdown_id<%= issue.id %>" class="z-10 hidden bg-white rounded-lg shadow-md w-44">
                  <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="issues_dropdown_<%= issue.id %>">
                    <li>
                      <%= link_to "View", issue,
                        class: "block w-full px-4 py-2 text-left font-medium rounded-md text-blue-600 hover:bg-blue-100 hover:text-blue-700 transition" %>
                    </li>
                    <li>
                      <%= link_to "Edit", edit_issue_path(issue),
                        class: "block w-full px-4 py-2 text-left font-medium rounded-md text-blue-600 hover:bg-blue-100 hover:text-blue-700 transition" %>
                    </li>
                    <li>
                      <%= button_to "Delete", issue, method: :delete,
                        class: "block w-full px-4 py-2 text-left font-medium rounded-md text-red-600 hover:bg-red-100 hover:text-red-700 font-semibold transition cursor-pointer",
                        data: { turbo_confirm: "Are you sure you want to delete this issue?" } %>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <ul class="pagination flex justify-center mt-4 space-x-2"></ul>
    <% else %>
      <div class="text-center my-10 p-8 bg-white rounded-sm shadow-md">
        <p class="text-gray-500 text-lg">No issues found. Start by creating a new one!</p>
      </div>
    <% end %>
  </div>
</div>
