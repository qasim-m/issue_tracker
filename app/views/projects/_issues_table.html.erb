<div data-controller="issues-search" class="overflow-x-auto" id="issues-container">
  <div class="justify_between_container mb-2 mt-4">
    <div class="icon_search_parent_div">
      <div class="icon_parent_div"><i class="fas fa-search gray_icon"></i></div>
      <input type="search" name="query" data-issues-search-target="search" id="projects-search" class="search search_icon_inp" placeholder="Search Issues..." />
    </div>
    <p class="medium_para">Total Issues: <%= @project.issues.count %></p>
  </div>
  <div id="issues">
    <% if @project.issues.any? %>
      <table class="table_gray">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 light_para">
              Issue No
              <i class="fa-solid fa-sort text-sm text-gray-500 hover:text-blue-600 cursor-pointer" 
                data-action="click->issues-search#sort" 
                data-sort="issue_number">
              </i>
            </th>
            <th class="px-4 py-2 light_para">
              Title
              <i class="fa-solid fa-sort text-sm text-gray-500 hover:text-blue-600 cursor-pointer" 
                data-action="click->issues-search#sort" 
                data-sort="title">
              </i>
            </th>
            <th class="px-4 py-2 light_para">
              Date Created
              <i class="fa-solid fa-sort text-sm text-gray-500 hover:text-blue-600 cursor-pointer" 
                data-action="click->issues-search#sort" 
                data-sort="created_at">
              </i>
            </th>
            <th class="px-4 py-2 light_para">
              Assigned To
              <i class="fa-solid fa-sort text-sm text-gray-500 hover:text-blue-600 cursor-pointer" 
                data-action="click->issues-search#sort" 
                data-sort="assigned_to">
              </i>
            </th>
            <th class="px-4 py-2 light_para">
              Status
              <i class="fa-solid fa-sort text-sm text-gray-500 hover:text-blue-600 cursor-pointer" 
                data-action="click->issues-search#sort" 
                data-sort="status">
              </i>
            </th>
            <th class="px-4 py-2 light_para">Action</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200 tableBody" data-issues-search-target="tableBody">
          <% @project.issues.each do |issue| %>
            <tr data-id="<%= issue.id %>" class="text-sm">
              <td class="px-2 py-1 normal_para issue_number"><%= issue.issue_number %></td>
              <td class="px-2 py-1 normal_para title"><%= issue.title %></td>
              <td class="px-2 py-1 normal_para created_at"><%= issue.created_at.strftime("%b %d, %Y") %></td>
              <td class="px-2 py-1 normal_para assigned_to"><%= issue.assigned_to.present? ? User.find(issue.assigned_to).name : "Unassigned" %></td>
              <td class="px-2 py-1 normal_para status">
                <span class="px-2 py-1 text-xs font-medium rounded-full 
                  <%= case issue.status
                      when "open" then "bg-green-100 text-green-700"
                      when "on_hold" then "bg-yellow-100 text-yellow-700"
                      when "in_progress" then "bg-blue-100 text-blue-700"
                      when "closed" then "bg-gray-200 text-gray-700"
                      else "bg-gray-100 text-gray-600"
                      end %>">
                  <%= issue.status.humanize %>
                </span>
              </td>
              <td class="px-2 py-1 normal_para">
                <button id="issues_dropdown_<%= issue.id %>" data-dropdown-toggle="issues_dropdown_id<%= issue.id %>" class="medium_gray_icon" type="button">
                  <i class="fa-solid fa-ellipsis"></i>
                </button>
                <div id="issues_dropdown_id<%= issue.id %>" class="z-10 hidden bg-white rounded-lg shadow-md w-44">
                  <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="issues_dropdown_<%= issue.id %>">
                    <li>
                      <%= link_to "View", issue, class: "link_blue" %>
                    </li>
                    <li>
                      <%= link_to "Edit", edit_issue_path(issue), class: "link_blue" %>
                    </li>
                    <li>
                      <%= button_to "Delete", issue, method: :delete,
                        class: "link_red", data: { turbo_confirm: "Are you sure you want to delete this issue?" } %>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <ul class="pagination flex justify-center mt-4 space-x-2"></ul>
    <% else %>
      <div class="items_center_container mt-10">
        <p class="small_para">No issues found. Start by creating a new one!</p>
      </div>
    <% end %>
  </div>
</div>
